<?phpdefined('BASEPATH') OR exit('No direct script access allowed');$this->load->view('layout/header');?><div class="content-wrapper">    <section class="content-header">        <h5>            <ol class="breadcrumb">                <li><a href="<?php echo base_url('auth/dashboard'); ?>"><i class="fa fa-dashboard"></i>Dashboard</a></li>                <li><a href="<?php echo base_url('refund_voucher'); ?>">Refund Voucher</a></li>                <li class="active">Add Refund Voucher</li>            </ol>        </h5>    </section>        <section class="content">        <div class="row">                       <div class="col-md-12">                <div class="box">                    <div class="box-header with-border">                        <h3 class="box-title">Add Refund Voucher</h3>                        <a class="btn btn-default pull-right back_button" id="sale_cancel" onclick1="cancel('refund_voucher')">Back</a>                    </div>                    <div class="box-body">                                              <form role="form" id="form" method="post" action="<?php echo base_url('refund_voucher/add_refund'); ?>">                            <div class="row">                                <div class="col-sm-3">                                    <div class="form-group">                                        <label for="date">Voucher Date<span class="validation-color">*</span></label>                                        <?php                                       $financial_year = explode('-', $this->session->userdata('SESS_FINANCIAL_YEAR_TITLE'));                                        if ((date("Y") != $financial_year[0]) && (date("Y") != $financial_year[1])) {                                            $date = '01-04-' . $financial_year[0];                                       } else {                                            $date = date('d-m-Y');                                       }                                       ?><div class="input-group date">                                            <input type="text" class="form-control datepicker" id="voucher_date" name="voucher_date" value="<?php echo $date; ?>">                                            <div class="input-group-addon">                                                <i class="fa fa-calendar"></i>                                            </div>                                        </div>                                        <span class="validation-color" id="err_voucher_date"></span>                                    </div>                                </div>                                <div class="col-sm-3">                                    <div class="form-group">                                        <label for="reference_no">Voucher Number <span class="validation-color">*</span></label>                                        <input type="text" class="form-control" id="voucher_number" name="voucher_number" value="<?= $voucher_number ?>" <?php                                       if ($access_settings[0]->invoice_readonly == 'yes') {                                            echo "readonly";                                        }                                        ?>>                                        <span class="validation-color" id="err_voucher_number"></span>                                    </div>                                </div>                                <div class="col-sm-3">                                    <div class="form-group">                                        <label for="customer">Customer <span class="validation-color">*</span></label>                                        <select class="form-control select2" autofocus="on" id="customer" name="customer">                                            <option value="">Select</option>                                            <?php                                            foreach ($customer as $row) {                                                if($row->customer_mobile != ''){                                                    echo "<option value='$row->customer_id-$row->customer_country_id-$row->customer_state_id'>$row->customer_name($row->customer_mobile)</option>";                                                }else{                                                    echo "<option value='$row->customer_id-$row->customer_country_id-$row->customer_state_id'>$row->customer_name</option>";                                                }                                            }                                            ?>                                        </select>                                        <span class="validation-color" id="err_customer"></span>                                    </div>                                </div>                                <div class="col-sm-3">                                    <div class="form-group">                                        <label for="customer">Advance Reference Number <span class="validation-color">*</span></label>                                        <select class="form-control select2" autofocus="on" id="reference_number" name="reference_number" style="width: 100%;">                                            <option value="">Select</option>                                        </select>                                        <div>                                            <span class="validation-color" id="err_reference_number"></span>                                        </div>                                    </div>                                </div>                            </div>                            <div class="row " >                                <div class="col-sm-3">                                    <div class="form-group">                                        <label for="amount">Refund Amount <span class="validation-color">*</span></label>                                        <input type="text" class="float_number form-control" id="receipt_amount" name="receipt_amount" value="" readonly>                                        <span class="validation-color" id="err_receipt_amount_1"></span>                                    </div>                                </div>                                <div class="col-sm-3">                                    <div class="form-group">                                        <label for="type_of_supply">Billing Country <span class="validation-color">*</span></label>                                        <select class="form-control select2" id="billing_country" name="billing_country">                                            <option value="">Select</option>                                            <?php                                            foreach ($country as $key) {                                                ?>                                                <option value='<?php echo $key->country_id ?>' <?php                                                if ($key->country_id == $branch[0]->branch_country_id) {                                                    echo "selected";                                                }                                                ?>>                                                    <?php echo $key->country_name; ?>                                                </option>                                                <?php                                            }                                            ?>                                        </select>                                        <span class="validation-color" id="err_billing_country"><?php echo form_error('billing_country'); ?></span>                                    </div>                                </div>                                <div class="col-sm-3">                                    <div class="form-group">                                        <label for="type_of_supply">Place of Supply <span class="validation-color">*</span></label>                                        <select class="form-control select2" id="billing_state" name="billing_state">                                            <option value="">Select</option>                                            <?php                                            foreach ($state as $key) {                                                ?>                                                <option value='<?php echo $key->state_id ?>' <?php                                                if ($key->state_id == $branch[0]->branch_state_id) {                                                    echo "selected";                                                }                                                ?> utgst='<?= $key->is_utgst; ?>'>                                                    <?php echo $key->state_name; ?>                                                </option>                                                <?php                                            }                                            ?>                                        </select>                                        <span class="validation-color" id="err_billing_state"><?php echo form_error('billing_state'); ?></span>                                    </div>                                </div>                                <div class="col-sm-3">                                    <div class="form-group">                                        <label for="currency_id">Billing Currency <span class="validation-color">*</span></label>                                        <?php $this->load->view('currency_dropdown');?>                                        <span class="validation-color" id="err_currency_id"></span>                                    </div>                                </div>                                <!--hidden -->                                <input type="hidden" name="branch_country_id" id="branch_country_id" value="<?php echo $branch[0]->branch_country_id; ?>">                                <input type="hidden" name="branch_state_id" id="branch_state_id" value="<?php echo $branch[0]->branch_state_id; ?>">                                <input type="hidden" class="form-control" id="advance_voucher_id" name="advance_voucher_id" value="" readonly>                                <input type="hidden" class="form-control" id="advance_voucher_number" name="advance_voucher_number" value="" readonly>                                <input type="hidden" class="form-control" id="voucher_date_old" name="voucher_date_old" value="<?php echo $date; ?>" readonly>                                <input type="hidden" class="form-control" id="module_id" name="module_id" value="<?= $module_id ?>" readonly>                                <input type="hidden" class="form-control" id="privilege" name="privilege" value="<?= $privilege ?>" readonly>                                <input type="hidden" class="form-control" id="voucher_number_old" name="voucher_number_old" value="<?= $voucher_number ?>" readonly>                                <input type="hidden" class="form-control" id="section_area" name="section_area" value="add_refund_voucher" readonly>                                <input type="hidden" class="form-control" id="reference_number_text" name="reference_number_text" value="" readonly>                                <input type="hidden" class="form-control" id="current_invoice_amount" name="current_invoice_amount" value="" readonly>                                <!-- <input type="hidden" class="form-control" id="section_area" name="section_area" value="add_sales" readonly> -->                                <input type="hidden" name="total_sub_total" id="total_sub_total">                                <input type="hidden" name="total_taxable_amount" id="total_taxable_amount">                                <input type="hidden" name="total_igst_amount" id="total_igst_amount">                                <input type="hidden" name="total_cgst_amount" id="total_cgst_amount">                                <input type="hidden" name="total_sgst_amount" id="total_sgst_amount">                                <input type="hidden" name="total_discount_amount" id="total_discount_amount">                                <input type="hidden" name="total_tax_amount" id="total_tax_amount">                                <input type="hidden" name="total_tax_cess_amount" id="total_tax_cess_amount">                                <input type="hidden" name="total_grand_total" id="total_grand_total">                                <input type="hidden" name="table_data" id="table_data">                                <!-- hidden -->                            </div>                            <div id="add_row_field">                            </div>                            <div class="row">                                <div class="col-sm-3 gst_payable_div">                                    <div class="form-group">                                        <label for="gst_payable">GST Payable(Reverse Charge) <span class="validation-color">*</span></label>                                                                                <div class="radio">                                            <label class="radio-inline">                                                <input type="radio" name="gst_payable" value="yes" /> Yes                                            </label>                                            <label class="radio-inline">                                                <input type="radio" name="gst_payable" value="no" checked="checked"/> No                                            </label>                                        </div>                                        <br/>                                        <span class="validation-color" id="err_gst_payable"></span>                                    </div>                                </div>                                <div class="col-sm-3">                                    <div class="form-group">                                        <label for="paying_by">Payment Mode<span class="validation-color">*</span></label>                                        <?php                                        if (isset($other_modules_present['bank_account_module_id']) && $other_modules_present['bank_account_module_id'] != "") {                                            ?>                                            <div class="input-group">                                                <div class="input-group-addon">                                                    <a href="" data-toggle="modal" data-target="#bank_account_modal" class="pull-right">+</a></div>                                            <?php } ?>                                            <!-- <a href="" data-toggle="modal" data-target="#bank_account_modal" class="pull-right">+ Add Account</a> -->                                            <select class="form-control select2" id="payment_mode" name="payment_mode">                                                <option value="">Select</option>                                                <option value="cash">Cash</option>                                                <?php                                                if (isset($other_modules_present['bank_account_module_id']) && $other_modules_present['bank_account_module_id'] != "") {                                                    foreach ($bank_account as $key => $value) {                                                        ?>                                                        <option value='<?php echo $value->bank_account_id . "/" . $value->ledger_title ?>'> <?php echo $value->ledger_title; ?> </option>                                                        <?php                                                    }                                                }                                                ?>                                                <option value="other payment mode">Other payment mode</option>                                            </select></div>                                        <span class="validation-color" id="err_payment_mode"></span>                                    </div>                                </div>                                <div id="other_payment" style="display: none;">                                    <div class="col-sm-3">                                        <div class="form-group">                                            <label for="bank_name">Payment Via</label>                                            <input type="text" class="form-control" id="payment_via" name="payment_via" value="">                                            <span class="validation-color" id="err_payment_via"></span>                                        </div>                                    </div>                                    <div class="col-sm-3">                                        <div class="form-group">                                            <label for="cheque_no">Reference Number</label>                                            <input type="text" class="form-control" id="ref_number" name="ref_number" value="">                                            <span class="validation-color" id="err_cheque_number"></span>                                        </div>                                    </div>                                </div>                                <div id="hide">                                    <div class="col-sm-3" style="display: none;">                                        <div class="form-group">                                            <label for="bank_name">Bank Name</label>                                            <input type="text" class="form-control" id="bank_name" name="bank_name" value="">                                            <span class="validation-color" id="err_bank_name"></span>                                        </div>                                    </div>                                    <div class="col-sm-3">                                        <div class="form-group">                                            <label for="cheque_no">Cheque Number</label>                                            <input type="number" class="form-control" id="cheque_number" name="cheque_number" value="">                                            <span class="validation-color" id="err_cheque_number"></span>                                        </div>                                    </div>                                    <div class="col-sm-3">                                        <div class="form-group">                                            <label for="cheque_date">Cheque Date</label>                                            <div class="input-group date">                                            <input type="text" class="form-control datepicker" id="cheque_date" name="cheque_date" value="">                                            <div class="input-group-addon">                                                <i class="fa fa-calendar"></i>                                            </div>                                        </div>                                            <span class="validation-color" id="err_cheque_date"></span>                                        </div>                                    </div>                                </div>                            </div>                            <div class="row">                                <div class="col-sm-12">                                    <div class="form-group">                                        <label for="paying_by">Description</label>                                        <textarea type="text" class="form-control" id="description" name="description" value=""></textarea>                                    </div>                                </div>                                <div class="col-sm-12">                                    <div class="form-group">                                        <label><?php echo $this->lang->line('purchase_inventory_items'); ?></label>                                        <div class="col-sm-8">                                            <span class="validation-color" id="err_product"></span>                                        </div>                                        <table class="table items table-striped table-bordered table-condensed table-hover sales_table" name="sales_data" id="sales_data">                                            <thead>                                                <tr>                                                    <!-- <th width="2%"><img src="<?php echo base_url(); ?>assets/images/bin1.png" /></th> -->                                                    <th>Items</th>                                                    <th>Description</th>                                                    <!--<th hidden="true">Quantity</th> -->                                                    <th>Taxable Amount</th>                                                    <!--<th hidden="true">Taxable Value</th> -->                                                    <th>GST(%)</th>                                                    <th>CESS(%)</th>                                                    <th>Total</th>                                                </tr>                                            </thead>                                            <tbody id="sales_table_body">                                            </tbody>                                        </table>                                        <p>                                            <span class="validation-color" id="err_amount_exceeds"></span>                                        </p>                                        <table id="table-total" class="table table-striped table-bordered table-condensed table-hover">                                            <tr>                                                <td align="right">Total Value (+)</td>                                                <td align='right'><span id="totalSubTotal"></span></td>                                            </tr>                                            <tr style="display: none">                                                <td align="right">Total Tax (+)</td>                                                <td align='right'><span id="totalTaxAmount"></span>                                                </td>                                            </tr>                                            <tr class='totalCGSTAmount_tr'>                                                <td align="right"><?php echo 'CGST'; ?> (+)</td>                                                <td align='right'>                                                    <span id="totalCGSTAmount">0.00</span>                                                </td>                                            </tr>                                            <tr class='totalSGSTAmount_tr'>                                                <td align="right"><?php echo 'SGST'; ?> (+)</td>                                                <td align='right'>                                                    <span id="totalSGSTAmount">0.00</span>                                                </td>                                            </tr>                                            <tr class='totalIGSTAmount_tr'>                                                <td align="right"><?php echo 'IGST'; ?> (+)</td>                                                <td align='right'>                                                    <span id="totalIGSTAmount">0.00</span>                                                </td>                                            </tr>                                            <tr class='totalCessAmount_tr'>                                                <td align="right"><?php echo 'Cess'; ?> (+)</td>                                                <td align='right'>                                                    <span id="totalTaxCessAmount">0.00</span>                                                </td>                                            </tr>                                            <tr>                                                <td align="right">Grand Total (=)</td>                                                <td align='right'><span id="totalGrandTotal"></span></td>                                            </tr>                                                                                   </table>                                    </div>                                </div>                            </div>                            <div class="box-footer">                                <button type="submit" id="receipt_submit" class="btn btn-info">Pay</button>                                <span class="btn btn-default" id="receipt_cancel" onclick="cancel('refund_voucher')">Cancel</span>                            </div>                            <?php                            $notes_sub_module = 0;                            if (in_array($notes_sub_module_id, $access_sub_modules)) {                                $notes_sub_module = 1;                            }                            if ($notes_sub_module == 1) {                                $this->load->view('sub_modules/notes_sub_module');                            }                            ?>                        </form>                    </div>                </div>            </div>        </div>    </section></div><?php$this->load->view('layout/footer');$this->load->view('bank_account/bank_modal');?><script type="text/javascript">    $('#hide').hide();    var sales_data = new Array();    var branch_state_list = <?php echo json_encode($state); ?>;    var item_gst = new Array();    var common_settings_round_off = "<?= $access_common_settings[0]->round_off_access ?>";    var common_settings_tax_split = "<?= $access_common_settings[0]->tax_split_equaly ?>";    var common_settings_amount_precision = "<?= $access_common_settings[0]->amount_precision ?>";    var settings_tax_percentage = "<?= $access_common_settings[0]->tax_split_percentage ?>";    var settings_tax_type = "<?= $access_settings[0]->tax_type ?>";    var settings_discount_visible = "<?= $access_settings[0]->discount_visible ?>";    var settings_description_visible = "<?= $access_settings[0]->description_visible ?>";    var settings_tds_visible = "<?= $access_settings[0]->tds_visible ?>";    var settings_item_editable = "<?= $access_settings[0]->item_editable ?>";    //date change    $('#voucher_date').on('changeDate', function (){        var selected = $(this).val();        var module_id = $("#module_id").val();        var date_old = $("#voucher_date_old").val();        var privilege = $("#privilege").val();        var old_res = date_old.split("-");        var new_res = selected.split("-");        if (old_res[1] != new_res[1])        {            $.ajax(                    {                        url: base_url + 'general/generate_date_reference',                        type: 'POST',                        data:                                {                                    date: selected,                                    privilege: privilege,                                    module_id: module_id                                },                        success: function (data)                        {                            console.log(data);                            var parsedJson = $.parseJSON(data);                            var type = parsedJson.reference_no;                            $('#voucher_number').val(type)                        }                    })        } else        {            var old_reference = $('#voucher_number_old').val();            $('#voucher_number').val(old_reference)        }    });</script><script src="<?php echo base_url('assets/js/vouchers/') ?>refund.js"></script><script src="<?php echo base_url('assets/js/vouchers/') ?>refund_basic.js"></script>