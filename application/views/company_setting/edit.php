<?phpdefined('BASEPATH') OR exit('No direct script access allowed');$this->load->view('layout/header');?><!-- Content Wrapper. Contains page content --><div class="content-wrapper">    <!-- Content Header (Page header) -->    <section class="content-header"></section>    <script type="text/javascript">        function cust_name() {            if (document.getElementById('cust_indi').checked) {                document.getElementById('comp_name').style.display = 'none';                document.getElementById('cust_name').style.display = 'inline';            }        }        function comp_name() {            if (document.getElementById('cust_comp').checked) {                document.getElementById('cust_name').style.display = 'none';                document.getElementById('comp_name').style.display = 'inline';            }        }    </script>    <div class="fixed-breadcrumb">        <ol class="breadcrumb abs-ol">            <li><a href="<?php echo base_url('auth/dashboard'); ?>"><i class="fa fa-dashboard"></i>                    <!-- Dashboard -->                    Dashboard</a>             </li>            <li>                <a href="<?php echo base_url('customer'); ?>">                    <!-- customer -->Customer</a>            </li>            <li class="active">                <!-- Add customer -->Add Customer</li>        </ol>    </div>    <section class="content mt-50">        <div class="row">            <div class="col-md-12">                <div class="box">                    <div class="box-header with-border">                        <h3 class="box-title">                            Edit Company                        </h3>                        <a href="javascript:void(0);" class="btn btn-sm btn-info pull-right add_button">Add New field</a>                     </div>                    <div class="box-body">                        <form role="form" id="form" method="post" action="<?php echo base_url('company_setting/update_branch'); ?>" encType="multipart/form-data">                            <div class="row">                                <div class="form-group col-md-4">                                    <input type="hidden" class="form-control" id="branch_id" name="branch_id" value="<?php                                    if (isset($data[0]->branch_id)) {                                        echo $data[0]->branch_id;                                    }                                    ?>">                                    <label for="company_code">Company Code<span class="validation-color">*</span>                                     </label>                                    <input type="text" class="form-control" id="company_code" name="company_code" value="<?php                                    if (isset($data[0]->branch_code)) {                                        echo $data[0]->branch_code;                                    }                                    ?>" readonly> <span class="validation-color" id="err_company_code"><?php echo form_error('company_code'); ?></span>                                 </div>                                <div class="form-group col-md-4">                                    <label for="company_name">Company Name<span class="validation-color">*</span>                                     </label>                                    <input type="text" class="form-control" id="company_name" name="company_name" value="<?php                                    if (isset($data[0]->branch_name)) {                                        echo $data[0]->branch_name;                                    }                                    ?>"> <span class="validation-color" id="err_company_name"><?php echo form_error('company_name'); ?></span>                                 </div>                                <div class="form-group col-md-4">                                    <label for="customer_name" id="cust_name">Company Logo<span class="validation-color">*</span>                                     </label>                                    <?php if (!isset($data[0]->branch_logo) || $data[0]->branch_logo == "") { ?>                                        <input type="file" class="form-control" id="logo" name="logo">                                        <p><small>Logo size (width: 150px & height: 50px)</small>                                        </p>                                    <?php } ?>                                    <div id="logo_pic">                                        <?php if (isset($data[0]->branch_logo) && $data[0]->branch_logo) { ?>                                            <img src="<?php echo base_url('assets/branch_files/') . $data[0]->branch_id . '/' . $data[0]->branch_logo; ?>" width="18%" id="logo_img"> <a href="" data-backdrop="static" data-keyboard="false" data-toggle="modal" data-target="#remove_logo" title="Remove Logo"><i class="fa fa-trash-o text-purple"></i></a>                                        <?php } ?>                                    </div>                                    <input type="hidden" id="hidden_logo_name" name="hidden_logo_name" value="<?php                                    if (isset($data[0]->branch_logo)) {                                        echo $data[0]->branch_logo;                                    }                                    ?>"> <span class="validation-color" id="err_logo"><?php echo form_error('logo'); ?></span>                                 </div>                                <div class="form-group col-md-4">                                    <label for="address">Address<span class="validation-color">*</span>                                     </label>                                    <textarea class="form-control" id="address" rows="2" name="address">                                        <?php                                        if (isset($data[0]->branch_address)) {                                            echo $data[0]->branch_address;                                        }                                        ?></textarea> <span class="validation-color" id="err_address"><?php echo form_error('address'); ?></span>                                 </div>                                <div class="form-group col-md-4">                                    <label for="gstin">Default Currency<span class="validation-color">*</span>                                    </label>                                    <select class="form-control select2" id="cmb_currency" name="cmb_currency" style="width: 100%;">                                        <option value="">Select Currency</option>                                        <?php                                        foreach ($currency as $key => $value) {                                            if ($value->currency_id == 75) {                                                echo "<option value='" . $value->currency_id . "' selected>" . $value->currency_name.' - ' . $value->country_shortname."</option>";                                            } else {                                                echo "<option value='" . $value->currency_id . "'>" . $value->currency_name .' - ' . $value->country_shortname. "</option>";                                            }                                        }                                        ?></select> <span class="validation-color" id="err_gstin"><?php echo form_error('gstin'); ?></span>                                 </div>                                <div class="form-group col-md-4">                                    <label for="gst">GST Number<span class="validation-color">*</span>                                    </label>                                    <input type="text" class="form-control" id="gst_number" name="gst_number" value="<?php                                    if (isset($data[0]->branch_gstin_number)) {                                        echo $data[0]->branch_gstin_number;                                    }                                    ?>"> <span class="validation-color" id="err_gstin"><?php echo form_error('gstin'); ?></span>                                 </div>                                <div class="col-md-12">                                    <div class="form-group">                                        <label for="">Tax Items<span class="validation-color">*</span>                                         </label>                                        <?php                                        $checked_gst = '';                                        if (isset($data[0]->gst)) {                                            if ($data[0]->gst == 0) {                                                $checked_gst = '';                                            } else {                                                $checked_gst = 'checked=checked';                                            }                                        } $checked_tds = '';                                        if (isset($data[0]->tds)) {                                            if ($data[0]->tds == 0) {                                                $checked_tds = '';                                            } else {                                                $checked_tds = 'checked=checked';                                            }                                        } $checked_cess = '';                                        if (isset($data[0]->cess)) {                                            if ($data[0]->cess == 0) {                                                $checked_cess = '';                                            } else {                                                $checked_cess = 'checked=checked';                                            }                                        }                                        ?>                                        <div class="checkbox">                                            <label>                                                <input type="checkbox" id="d_gst" name="d_gst" value="1" <?php echo $checked_gst; ?>> GST</label>                                        </div>                                        <div class="checkbox">                                            <label>                                                <input type="checkbox" id="tds" name="tds" value="1" <?php echo $checked_tds; ?>> TDS/TCS</label>                                        </div>                                        <div class="checkbox">                                            <label>                                                <input type="checkbox" id="cess" name="cess" value="1" <?php echo $checked_cess; ?>> CESS</label>                                        </div>                                    </div>                                </div>                                <div class="col-sm-12" id="g_gst_items">                                    <div class="row">                                        <div class="col-sm-4">                                            <div class="form-group">                                                <label>CGST</label>                                                <input type="text" class="form-control" id="cgst" name="cgst" value='<?php                                                if (isset($data[0]->cgst_percentage)) {                                                    echo $data[0]->cgst_percentage;                                                }                                                ?>'>                                            </div>                                        </div>                                        <div class="col-sm-4">                                            <div class="form-group">                                                <label>SGST</label>                                                <input type="text" class="form-control" id="sgst" name="sgst" value='<?php                                                if (isset($data[0]->sgst_percentage)) {                                                    echo $data[0]->sgst_percentage;                                                }                                                ?>'>                                            </div>                                        </div>                                        <div class="col-sm-4">                                            <div class="form-group">                                                <label>IGST</label>                                                <input type="text" class="form-control" id="igst" name="igst" value='<?php                                                if (isset($data[0]->igst_percentage)) {                                                    echo $data[0]->igst_percentage;                                                }                                                ?>'>                                            </div>                                        </div>                                        <div class="col-sm-4">                                            <div class="form-group">                                                <label>UGST</label>                                                <input type="text" class="form-control" id="ugst" name="ugst" value='<?php                                                if (isset($data[0]->ugst_percentage)) {                                                    echo $data[0]->ugst_percentage;                                                }                                                ?>'>                                            </div>                                        </div>                                    </div>                                </div>                                <div class="form-group col-md-4">                                    <label for="country">Country<span class="validation-color">*</span>                                     </label>                                    <select class="form-control select2" id="cmb_country" name="cmb_country" style="width: 100%;">                                        <option value="">Select Country</option>                                        <?php                                        foreach ($country as $row) {                                            if (isset($data[0]->branch_country_id)) {                                                if ($row->country_id == $data[0]->branch_country_id) {                                                    echo "<option value='" . $row->country_id . "' selected>" . $row->country_name . "</option>";                                                } else {                                                    echo "<option value='" . $row->country_id . "'>" . $row->country_name . "</option>";                                                }                                            } else {                                                echo "<option value='" . $row->country_id . "'>" . $row->country_name . "</option>";                                            }                                        }                                        ?></select> <span class="validation-color" id="err_country"></span>                                 </div>                                <div class="form-group col-md-4">                                    <label for="state">State <span class="validation-color">*</span>                                     </label>                                    <select class="form-control select2" id="cmb_state" name="cmb_state" style="width: 100%;">                                        <option value="">Select State</option>                                        <?php                                        foreach ($state as $row) {                                            if (isset($data[0]->branch_state_id)) {                                                if ($row->state_id == $data[0]->branch_state_id) {                                                    echo "<option value='" . $row->state_id . "' selected>" . $row->state_name . "</option>";                                                } else {                                                    echo "<option value='" . $row->state_id . "'>" . $row->state_name . "</option>";                                                }                                            } else {                                                echo "<option value='" . $row->state_id . "'>" . $row->state_name . "</option>";                                            }                                        }                                        ?>                                    </select>                                    <span class="validation-color" id="err_state"></span>                                 </div>                                <div class="form-group col-md-4">                                    <label for="city">City<span class="validation-color">*</span>                                     </label>                                    <select class="form-control select2" id="cmb_city" name="cmb_city" style="width: 100%;">                                        <option value="">Select City</option>                                        <?php                                        foreach ($city as $row) {                                            if (isset($data[0]->branch_city_id)) {                                                if ($row->city_id == $data[0]->branch_city_id) {                                                    echo "<option value='" . $row->city_id . "' selected>" . $row->city_name . "</option>";                                                } else {                                                    echo "<option value='" . $row->city_id . "'>" . $row->city_name . "</option>";                                                }                                            } else {                                                echo "<option value='" . $row->city_id . "'>" . $row->city_name . "</option>";                                            }                                        } if ($data[0]->branch_city_id == 0) {                                            echo "<option value='0' selected>Others</option>";                                        } else {                                            echo "<option value='0'>Others</option>";                                        }                                        ?></select> <span class="validation-color" id="err_city"></span>                                 </div>                                <div class="field_wrapper">                                    <?php                                    $i = 1;                                    foreach ($additional_info as $row) {                                        ?>                                        <div class="col-sm-4 form-group">                                            <label>                                                <input type="text" id="custom_lablel<?php echo $i; ?>" name="custom_lablel[]" Placeholder="Textfield" class="disable_in form-control custom_lablel" id="edit_label" value="<?php echo $row->column_name; ?>">                                            </label><a href="javascript:void(0);" class="remove_button btn btn-info btn-xs pull-right" title="Remove"><i class="fa fa-minus"></i></a>                                            <input type="text" id="custom_field<?php echo $i; ?>" name="custom_field[]" value="<?php echo $row->value; ?>" class="form-control custom_field" />                                        </div>                                        <?php                                        $i++;                                    }                                    ?>                                </div>                            </div>                            <div class="row">                                <div class="col-sm-12">                                    <div class="box-footer">                                        <button type="submit" id="company_submit" class="btn btn-info">Add</button>                                        <button class="btn btn-default" id="cancel" onclick="cancel('company_setting')">Cancel</button>                                     </div>                                </div>                            </div>                        </form>                    </div>                </div>            </div>        </div>    </section></div><div id="remove_logo" class="modal fade z_index_modal" role="dialog" data-backdrop="static">    <div class="modal-dialog modal-md">        <form id="logoForm">            <div class="modal-content">                <div class="modal-header">                    <button type="button" class="close" data-dismiss="modal">&times;</button>                    <h4 class="modal-title">Remove Logo</h4>                 </div>                <div class="modal-body">                    <label for="category_name">Are your sure! You want to remove logo ?</label>                </div>                <div class="modal-footer"> <a href="<?php echo base_url('company_setting/remove_logo_branch/' . $data[0]->branch_id); ?>" class="btn btn-sm btn-info pull-right" style="margin-left: 10px;">Yes</a>                    <button class="btn btn-sm btn-submit pull-right" data-dismiss="modal">No</button>                </div>            </div>        </form>    </div></div><?php $this->load->view('layout/footer'); ?><script><?php if ($data[0]->gst == 1) { ?>        $("#g_gst_items").show();<?php } else {    ?>        $("#g_gst_items").hide();<?php }?>    $("#company_submit").click(function () {        var c_code = $("#company_code").val();        var c_name = $("#company_name").val();        var currency = $("#cmb_currency").val();        var gst_number = $("#gst_number").val();        var address = $('#address').val();        var country = $('#cmb_country').val();        var state = $('#cmb_state').val();        var city = $('#cmb_city').val();        var flag_label = 'N';        $(".custom_lablel").each(function () {            var lbl = $(this).val();            if (lbl == '') {                flag_label = 'Y';            }        });        var flag_value = 'N';        $(".custom_field").each(function () {            var val_cu = $(this).val();            if (val_cu == '') {                flag_value = 'Y';            }        });        if (c_code == null || c_code == "") {            $("#err_company_code").text('Please Enter Company Code');            return false;        } else {            $("#err_company_code").text('');        }        if (c_name == null || c_name == "") {            $("#err_company_name").text('Please Enter Company Code');            return false;        } else {            $("#err_company_name").text('');        }        if (address == null || address == "") {            $("#err_address").text('Please Enter Address');            return false;        } else {            $("#err_address").text('');        }        if (country == null || country == "") {            $("#err_country").text("Please Select Country ");            return false;        } else {            $("#err_country").text("");        }        if (state == null || state == "") {            $("#err_state").text("Please Select State ");            return false;        } else {            $("#err_state").text("");        }        if (city == null || city == "") {            $("#err_city").text("Please Select City ");            return false;        } else {            $("#err_city").text("");        }        if (flag_value == 'Y' || flag_label == 'Y') {            alert_d.text ='Please Enter valid input for customer field and label';            PNotify.error(alert_d);            return false;        }    });    $('#vat').click(function () {        if ($(this).prop("checked") == true) {            $("#gst, #d_gst").prop("checked", false);            $("#gst, #d_gst").attr("disabled", true);        } else if ($(this).prop("checked") == false) {            $("#gst, #d_gst").attr("disabled", false);        }    });    $('#d_gst').click(function () {        if ($(this).prop("checked") == true) {            $("#g_gst_items").show();            $("#vat, #service_tax, #gst").prop("checked", false);            $("#vat, #service_tax, #gst").attr("disabled", true);        } else if ($(this).prop("checked") == false) {            $("#g_gst_items").hide();            $("#vat, #service_tax, #gst").attr("disabled", false);        }    });    $('#gst').click(function () {        if ($(this).prop("checked") == true) {            $("#vat, #service_tax, #d_gst").prop("checked", false);            $("#vat, #service_tax, #d_gst").attr("disabled", true);        } else if ($(this).prop("checked") == false) {            $("#vat, #service_tax, #d_gst").attr("disabled", false);        }    });</script>			<script type="text/javascript">    $(document).ready(function () {        var maxField = 10;        //Input fields increment limitation        var addButton = $('.add_button');        //Add button selector        var wrapper = $('.field_wrapper');        //New input field html        var x = <?php echo $additional_info_count + 1; ?>;        var count = <?php echo $additional_info_count + 1; ?>;        //Initial field counter is 1        //Once add button is clicked        $(addButton).click(function () {            //Check maximum number of input fields            var flag_label = 'N';            $(".custom_lablel").each(function () {                var lbl = $(this).val();                if (lbl == '') {                    flag_label = 'Y';                }            });            var flag_value = 'N';            $(".custom_field").each(function () {                var val_cu = $(this).val();                if (val_cu == '') {                    flag_value = 'Y';                }            });            if (flag_value == 'Y' || flag_label == 'Y') {                alert_d.text ='Please Enter valid input for customer field and label';                PNotify.error(alert_d);                return false;            } else {                if (x < maxField) {                    //Input field wrapper                    var fieldHTML = '<div class="col-sm-4 form-group"><label><input type="text" id="custom_lablel' + count + '" name="custom_lablel[]" Placeholder="Textfield" class="disable_in form-control custom_lablel" id="edit_label"></label><a href="javascript:void(0);" class="remove_button btn btn-info btn-xs pull-right" title="Remove"><i class="fa fa-minus"></i></a><input type="text" id="custom_field' + count + '" name="custom_field[]" value="" class="form-control custom_field"/></div>';                    x++;                    //Increment field counter                    count++;                    $(wrapper).append(fieldHTML);                    //Add field html                }            }        });        //Once remove button is clicked        $(wrapper).on('click', '.remove_button', function (e) {            e.preventDefault();            $(this).parent('div').remove();            //Remove field html            x--;            //Decrement field counter        });        $(wrapper).on('dblclick', '#edit_label', function () {            console.log("fdf");            $(this).removeClass('disable_in');        });        $("#gst_number").on("blur keyup", function (event) {            var gstin = $('#gst_number').val();            $("#gst_number").val(gstin.toUpperCase());            var gstin_length = gstin.length;            if (gstin_length > 0)            {                if (gstin == null || gstin == "") {                    $("#err_gstin").text("Please Enter GSTIN Number.");                    return false;                } else {                    $("#err_gstin").text("");                }                if (!gstin.match(sname_regex)) {                    $('#err_gstin').text("Please Enter Valid GSTIN Number.");                    return false;                } else {                    $("#err_gstin").text("");                }                if (gstin_length < 15 || gstin_length > 15)                {                    $("#err_gstin").text("GSTIN Number should have length 15");                    return false;                } else {                    $("#err_branch_gstin_number").text("");                }            }        });    });    $('#cmb_country').change(function () {        var id = $(this).val();        $('#cmb_state').empty();        $('#cmb_city').empty();        $.ajax({            url: base_url + 'general/get_state/',            method: "POST",            data: {id: id},            dataType: "JSON",            success: function (data) {                console.log(data);                var state = $('#cmb_state');                var opt = document.createElement('option');                opt.text = 'Select State';                opt.value = '';                state.append(opt);                var city = $('#cmb_city');                var opt1 = document.createElement('option');                opt1.text = 'Select City';                opt1.value = '';                city.append(opt1);                for (i = 0; i < data.length; i++) {                    $('#cmb_state').append('<option value="' + data[i].state_id + '">' + data[i].state_name + '</option>');                }            }        });    });    $('#cmb_state').change(function () {        var id = $(this).val();        $('#cmb_city').empty();        $.ajax({            url: base_url + 'general/get_city/' + id,            dataType: "JSON",            success: function (data) {                console.log(data);                var city = $('#cmb_city');                var opt = document.createElement('option');                opt.text = 'Select City';                opt.value = '';                city.append(opt);                for (i = 0; i < data.length; i++) {                    $('#cmb_city').append('<option value="' + data[i].city_id + '">' + data[i].city_name + '</option>');                }                var opt1 = document.createElement('option');                opt1.text = 'Others';                opt1.value = '0';                city.append(opt1);            }        });    });</script>